# Установка прошивки Betaflight

## Проверка DFU mode 
Желательно заранее проверить, переходит ли дрон в режим загрузчика (DFU).Потому что если с этим будут проблемы и нужно будет ставить драйвера, лучше сделать это сразу, чтобы не отвлекаться при прошивке.  
Один из вариантов перевода дрона (полетника) в DFU:  

Вариант 1.  
На вкладке Setup нажать кнопку Activate Boot Loader / DFU.  

Вариант 2.  
- Подключаем дрон к компьютеру и загружаем Betaflight Configurator
- Переходим на вкладку CLI и вводим команду:  
`bl`  

Вариант 3.  
Зажать кнопку на полетнике и подать питаниею

При успешном переходе в DFU в верхнем правом углу с выбором порта должно появиться надпись типа:  
`DFU - STM32 BOOTLOADER`  
`DFU - DFU in FS Mode`  

Если ничего не появилось, открываем на компьютере Диспетчер устройств и смотрим, нет ли неизвестных устройств.  
Если есть неизвестное устройство с именем типа `STM32 Virtual COM Port`,
в этом случае надо скачать и установить [ImpulseRC Driver Fixer](https://impulserc.com/pages/downloads).  
Запускаем скачанную программу. Появится лого, будет долго висеть. Потом неизвестное устройство пропадет. Работа закончится и программа попросит перезагрузить комп, но этого делать не обязательно.  

Отключаем, подключаем дрон к компу.  
Еще раз пробуем перевести в DFU. В верхнем правом углу с выбором порта должно появиться `DFU - STM32 BOOTLOADER`.

Оригинальная статья: [How to Enter DFU Mode on Flight Controller for Betaflight and iNav Firmware](https://oscarliang.com/dfu-mode/)  

## Установка прошивки на примере Betaflight 4.5.1.
Подключаем дрон к компьютеру и загружаем Betaflight Configurator.  
**ОБЯЗАТЕЛЬНО делаем бакап**.  
Переходим на вкладку `Firmware Flasher`.  
Нажимаем Auto-detect
Произойдет определение полетникаю Например `BETAFPVF4SX1280` (для полетника от BETAFPV).  
Выбираем опции:  
`GPS` (если нужно),  
`LED Strip` (если нужно),  
`OSD (Analog)` (для аналогового VTX)  
`OSD (HD)` (для цифрового VTX если нужно)  
`Pin IO` (не знаю что это)  
`VTX`  
!!! НИ в коем случае не выбирать оба, если стоит аналоговый VTX. Иначе не будет OSD на экране шлема.  
Если же выбраны все же оба, можно изменить командой:  
```
set osd_displayport_device = MAX7456
set vcd_video_system = AUTO
save
```

Объяснение тут [FAQ / No OSD in Betaflight 4.5](https://hackmd.io/@nerdCopter/r1JbnG0Q0)  

Нажимаем `Load Firmware`.   
Ждем пока скачается прошивка и станет активной кнопка `Flash Firmware`.  
Нажимаем ее.  
Опять предложит сделать бакап. Сделайте, если еще не сделали :)  
Дрон должен перейти в режим DFU. Если не перешел, смотрим раздел выше.   
Пойдет прошивка.  
По окончании можно переподключить дрон, зайти в Configurator.  
Накатить заранее созданный бакап.  
В закладке Конфигурация потребуется повторно включить OSD (появится вкладка) и LED Strip (появится вкладка).  
Так же на вкладке приемника возможно потребуется повторно включить Telemetry.  

