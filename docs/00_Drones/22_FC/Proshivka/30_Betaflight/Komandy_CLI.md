# Полезные команды Betaflight CLI

| Команда | Что делает? |
| --- | --- |
| `status` | Показывает версию прошивки, нагрузку на процессор и причины, по которым дрон не встает в Arm (запрет запуска). |
| `diff all` | Выводит список всех ваших личных настроек (удобно для бэкапа). |
| `resource` | Показывает, какой контакт на процессоре управляет каким мотором/периферией. Позволяет «переназначить» сгоревший выход мотора на другой свободный контакт. |
| `resource show` |  получить список всех площадок и их использование. См. видео [Setting Up Softserial In Betaflight! New Command In 4.5! - FPV Questions](https://www.youtube.com/watch?v=Yx27d-7zNJY). |
| `set [параметр]` | Изменяет конкретную настройку. |
| `get [слово]` | Ищет все параметры, содержащие это слово (например, `get gyro`). |
| `defaults` | Сбрасывает полетный контроллер к заводским настройкам. |
| `save` | Сохраняет всё и перезагружает контроллер. |
| `bl`   | Перейти в режим `Boot Loader / DFU`  |


## Устройство для передачи OSD

Команда `osd_displayport_device` в Betaflight используется для настройки устройства, через которое передаются данные OSD (On-Screen Display) по DisplayPort. 
Считать значение можно запустив команду:  
`get osd_displayport_device`  
Ответ из полетника на аналоговом VTX:  
```
# get osd_displayport_device
osd_displayport_device = AUTO
Allowed values: NONE, AUTO, MAX7456, MSP, FRSKYOSD
```

Возможные значения:   
- `MAX7456` - аналоговый OSD, работающий через чип MAX7456. Это стандартный чип для FPV-систем с аналоговым видео (PAL/NTSC)    
- `MSP` - MSP-порт для отправки OSD-данных на цифровые системы или через UART.   
- `FRSKYOSD` - OSD системы FrSky, передающее данные через телеметрию FrSky SmartPort.  
- `auto` – Betaflight автоматически выбирает устройство DisplayPort.  
- `dji` – Принудительно использовать DJI FPV Air Unit или Caddx Vista.  
- `hdzero` – Принудительно использовать HDZero VTX.  
- `walksnail` – Принудительно использовать Walksnail Avatar VTX.  
- `none` – Отключает передачу данных OSD через DisplayPort.  

Если нужно явно указать порт, используется команда:  
`set osd_displayport_device = НУЖНОЕ_ЗНАЧЕНИЕ`

Прошивая полетник с аналоговым VTX на Betaflight 4.5.x можно случайно указать в опциях оба вида OSD: `OSD (Analog)` и `OSD (HD)`. И тогда на экране не будет OSD, потому что по умолчанию будет направляться в HD.  
Чтобы вернуть на аналог надо запустить следующие команды:
```
set osd_displayport_device = MAX7456
set vcd_video_system = AUTO
save
```
Объяснение тут [FAQ / No OSD in Betaflight 4.5](https://hackmd.io/@nerdCopter/r1JbnG0Q0)  

## ELRS приемник по SPI протоколу
Если ELRS приемник подключен к полетнику , он не имеет собственного WiFi сайта. Все настройки осуществляются через CLI в Betaflight Configurator.

### номер модели для Model Match

```get expresslrs_model_id```
Значение от 0-255. 255 означает Model Match отключен.

```set expresslrs_model_id = N```

### Packet Rate
``` get expresslrs_rate_index```

На странице [How to Bind with F4 Betaflight FC (SPI ExpressLRS Receiver)](https://support.betafpv.com/hc/en-us/articles/4403742839705-How-to-Bind-with-F4-Betaflight-FC-SPI-ExpressLRS-Receiver) сайта BETAFPV указано:  
- 500Hz = 0  
- 250Hz = 1  
- 150Hz = 2  
- 50Hz = 3

Ставить значение обычно не нужно. Оно устанавливается автоматически при успешном бинде.

### Установка Bind фразы
Устаревший способ. Обычно уже есть поле ввода.


```set expresslrs_uid = [ Your UID bytes ]```
где UID - это хеш  
Сначала нужно превратить Bind фразу в коды и потом ввести ее.
Для этого идем на страницу [UID Byte Generator сайта https://www.expresslrs.org.](https://www.expresslrs.org/hardware/spi-receivers/?h=uid#uid-byte-generator).  
Там в поле Binding Phrase вводим свое слово. Ниже появятся нужные коды и команда, которую надо ввести в CLI.


## Turtle mode settings
``
set crashflip_motor_percent = 0  
set crashflip_expo = 35
``
Подробности в видео [My Whoop Won't Flip Over! Fixing Turtle Mode? - FPV Questions. YouTube: Joshua Bardwell Livestream Clips](https://www.youtube.com/watch?v=U4AvhJiqLPM)


## Список команд для проверки состояния дрона

Эта последовательность команд — «чек-ап» профессионального инженера. Она поможет вам понять, всё ли в порядке с электроникой и почему дрон может капризничать.

Введите эти команды по очереди в строку ввода CLI:

---

### 1. Команда `status`

Это самая важная команда. Она показывает «здоровье» системы.

* **На что смотреть:** * `MCU Load`: Нагрузка на процессор. В идеале должна быть **ниже 50%**. Если выше 75% — дрон может зависнуть в полете.
* `Arming flags`: Если там есть слова (например, `CALIB`, `CLI`, `MSP`), значит, дрон **не заармится**. Это подскажет вам, почему моторы не крутятся.
* `Voltage`: Видит ли плата напряжение аккумулятора.

### 2. Команда `tasks`

Позволяет увидеть частоту работы гироскопа и PID-петли.

* **На что смотреть:** В строке `Gyro/PID` частота должна быть стабильной (например, 8000Hz или 3200Hz) с минимальными отклонениями (Rate/hz). Если цифры сильно «прыгают», значит, процессор не справляется.

### 3. Команда `get motor_protocol`

Проверяет, какой протокол общения с регуляторами (ESC) выбран.

* **На что смотреть:** Если у вас современные регуляторы, там должно быть написано `DSHOT600` или `DSHOT300`. Если там `ONESHOT`, а у вас современный дрон — вы теряете в плавности полета.

### 4. Команда `resource show all`

Показывает распределение «пинов» процессора.

* **На что смотреть:** Здесь можно проверить, не конфликтуют ли устройства. Например, если один и тот же контакт назначен и на мотор, и на светодиоды, система будет работать со сбоями.

### 5. Команда `diff all` (просто посмотреть)

Выведет все ваши личные настройки.

* **Совет:** Просто пролистайте текст вверх. Вы увидите свои настройки портов (`serial`), настройки приемника и рейты. Это лучший способ убедиться, что конфигуратор «помнит» всё, что вы настраивали на других вкладках.

---

### Данные GPS
Если вы подключили GPS, введите `gpspassthrough`. Это позволит вам увидеть сырые данные, которые приходят со спутников (требует перезагрузки ПК для выхода).
